import random
import os
from random import randint


class UserFaker:
    accountPath = 'data/twitter_accounts/'
    accountsLists = os.listdir(accountPath)
    gender = ["m", "f", "s", "c"]

    def get_account(self):
        accountFile = random.choice(self.accountsLists)
        with open(self.accountPath + accountFile, 'r') as f:
            accounts = f.read().split('\n')
        account = random.choice([account for account in accounts if '@' in account and ' ' not in account])

        email = account.split(':')[0]
        username = email.split('@')[0].replace('-', '_').replace('.', '_')
        password = account.split(':')[1]

        return {
            'username': username,
            'password': password,
            'email': email
        }

    def get_random_dob(self):
        return {'dob': str(randint(1, 12)) + "-" + str(randint(1, 28)) + "-" + str(randint(1950, 2003))}

    def get_random_gender(self):
        return {'gender': random.choice(self.gender)}

    def generate_data(self, registration_limit):
        print("Generating random data for " + str(registration_limit))
        all_accounts = []
        for i in range(registration_limit):
            account = {}
            account.update(self.get_account())
            account.update(self.get_random_dob())
            account.update(self.get_random_gender())
            print('Generated:\n' + str(account))
            all_accounts.append(account)

        return all_accounts
